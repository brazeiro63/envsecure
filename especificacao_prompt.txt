ğŸ¤– Prompt para Agente de GeraÃ§Ã£o de CÃ³digo

ğŸ“‹ Contexto e Objetivo

VocÃª deve criar uma aplicaÃ§Ã£o Python independente e genÃ©rica para gerenciamento de variÃ¡veis de ambiente e segredos.
(baseada na soluÃ§Ã£o segura implementada no diretÃ³rio /environment do projeto PoisSim WhatsApp Assistant)

ğŸ¯ EspecificaÃ§Ãµes da AplicaÃ§Ã£o

Nome da AplicaÃ§Ã£o: EnvSecure Manager

Arquitetura Desejada:

envsecure/
â”œâ”€â”€ cli/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # Entry point CLI
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ init.py          # Inicializar projeto
â”‚   â”‚   â”œâ”€â”€ catalog.py       # Catalogar variÃ¡veis
â”‚   â”‚   â”œâ”€â”€ configure.py     # Configurar ambientes
â”‚   â”‚   â”œâ”€â”€ deploy.py        # Deploy seguro
â”‚   â”‚   â””â”€â”€ validate.py      # Validar configuraÃ§Ãµes
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ scanner.py           # Escanear cÃ³digo por variÃ¡veis
â”‚   â”œâ”€â”€ catalog.py           # Gerenciar catÃ¡logo
â”‚   â”œâ”€â”€ template.py          # Gerar templates
â”‚   â”œâ”€â”€ secrets.py           # Gerenciar segredos
â”‚   â”œâ”€â”€ validator.py         # ValidaÃ§Ãµes de seguranÃ§a
â”‚   â””â”€â”€ deployer.py          # Deploy para ambientes
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ environment.py       # Modelo de ambiente
â”‚   â”œâ”€â”€ variable.py          # Modelo de variÃ¡vel
â”‚   â””â”€â”€ secret.py            # Modelo de segredo
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crypto.py            # Criptografia/hashing
â”‚   â”œâ”€â”€ ssh.py               # OperaÃ§Ãµes SSH
â”‚   â””â”€â”€ filesystem.py       # OperaÃ§Ãµes de arquivo
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ project_structure/
â”‚   â”œâ”€â”€ deploy_scripts/
â”‚   â””â”€â”€ config_files/
â”œâ”€â”€ tests/
â”œâ”€â”€ setup.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ pyproject.toml

ğŸ” Funcionalidades Principais

1. Escaneamento AutomÃ¡tico de CÃ³digo

envsecure scan --path /projeto --output catalog.csv
- Escanear arquivos Python, Docker, YAML, JSON por variÃ¡veis de ambiente
- Detectar padrÃµes: os.getenv(), ${VAR}, ENV VAR, etc.
- Categorizar automaticamente por padrÃµes (database, api_keys, secrets, etc.)
- Exportar catÃ¡logo em CSV/JSON

2. InicializaÃ§Ã£o de Projeto

envsecure init --project-name "minha-app" --environments dev,staging,prod
- Criar estrutura de diretÃ³rios segura
- Gerar templates de configuraÃ§Ã£o
- Configurar .gitignore apropriado
- Criar scripts de deploy seguros

3. Gerenciamento de CatÃ¡logo

envsecure catalog add DATABASE_URL --category database --sensitive true --required true
envsecure catalog list --filter sensitive=true
envsecure catalog export --format csv

4. ConfiguraÃ§Ã£o de Ambientes

envsecure configure dev --interactive
envsecure configure prod --from-template --secrets-file secrets.prod

5. Deploy Seguro

envsecure deploy dev --local
envsecure deploy prod --ssh user@host:/path --key ~/.ssh/id_rsa

6. ValidaÃ§Ã£o de SeguranÃ§a

envsecure validate --environment prod --check-strength --audit-secrets

ğŸ›¡ï¸ Recursos de SeguranÃ§a ObrigatÃ³rios

Baseados na SoluÃ§Ã£o Original:

1. SeparaÃ§Ã£o Template/Secrets
  - Templates .safe sem valores sensÃ­veis
  - Arquivos secrets.* separados e nÃ£o commitados
  - SubstituiÃ§Ã£o segura via envsubst ou similar
2. ValidaÃ§Ã£o Robusta
  - Verificar presenÃ§a de segredos obrigatÃ³rios
  - Detectar valores placeholder (your_*_here)
  - Validar forÃ§a de senhas/chaves (mÃ­nimo 16-32 chars)
  - Confirmar resoluÃ§Ã£o completa de templates
3. Deploy Seguro
  - SSH criptografado para ambientes remotos
  - PermissÃµes restritivas (600) nos arquivos
  - Backup automÃ¡tico antes de substituir
  - DestruiÃ§Ã£o segura de arquivos temporÃ¡rios (shred)
4. PrevenÃ§Ã£o de Vazamentos
  - Arquivos de segredos no .gitignore
  - Logs nÃ£o expÃµem valores sensÃ­veis
  - Templates git-safe separados

ğŸ¨ Interface CLI Desejada

# Comando principal
envsecure --help

# Comandos principais
envsecure init                    # Inicializar projeto
envsecure scan                    # Escanear variÃ¡veis
envsecure catalog                 # Gerenciar catÃ¡logo
envsecure configure               # Configurar ambientes
envsecure deploy                  # Deploy seguro
envsecure validate               # Validar configuraÃ§Ã£o
envsecure generate-keys          # Gerar chaves seguras

# Exemplos de uso
envsecure init myapp --envs dev,prod
envsecure scan --path . --pattern "*.py,*.yml,Dockerfile"
envsecure catalog add JWT_SECRET_KEY --category auth --sensitive --min-length 32
envsecure configure dev --wizard
envsecure deploy prod --ssh deploy@server --validate-first
envsecure validate --env prod --audit --report security-audit.txt

ğŸ“Š Modelos de Dados

Variable Model:

@dataclass
class EnvironmentVariable:
    name: str
    category: str
    description: str
    required: bool = False
    sensitive: bool = False
    min_length: Optional[int] = None
    pattern: Optional[str] = None
    default_dev: Optional[str] = None
    default_prod: Optional[str] = None
    detected_in: List[str] = field(default_factory=list)

Environment Model:

@dataclass
class Environment:
    name: str
    description: str
    variables: Dict[str, str]
    secrets: Dict[str, str]
    deploy_target: Optional[DeployTarget] = None

Deploy Target:

@dataclass
class DeployTarget:
    type: str  # 'local', 'ssh', 'docker', 'k8s'
    host: Optional[str] = None
    user: Optional[str] = None
    key_file: Optional[str] = None
    target_path: str = ".env"

ğŸ”§ DependÃªncias Sugeridas

# requirements.txt
click>=8.0.0          # CLI framework
cryptography>=3.0.0   # Criptografia
paramiko>=2.7.0       # SSH operations
pydantic>=1.8.0       # Data validation
rich>=10.0.0          # CLI formatting
pyyaml>=5.4.0         # YAML parsing
python-dotenv>=0.19.0 # .env manipulation
jinja2>=3.0.0         # Template engine

ğŸ“ Casos de Uso Principais

Caso 1: Novo Projeto Python

1. envsecure init minha-api --envs dev,staging,prod
2. envsecure scan --path . --auto-categorize
3. envsecure configure dev --wizard
4. envsecure deploy dev --local

Caso 2: Projeto Existente

1. envsecure scan --path . --import-existing .env
2. envsecure catalog review --interactive
3. envsecure configure --migrate-from .env
4. envsecure validate --all-envs --security-audit

Caso 3: Deploy ProduÃ§Ã£o

1. envsecure configure prod --secrets-wizard
2. envsecure validate prod --strict
3. envsecure deploy prod --ssh user@prod-server --backup --dry-run
4. envsecure deploy prod --ssh user@prod-server --confirm

ğŸ¯ Diferenciais da SoluÃ§Ã£o

1. GenÃ©rica: Funciona com qualquer projeto Python
2. Segura: Implementa as melhores prÃ¡ticas da soluÃ§Ã£o original
3. Intuitiva: CLI amigÃ¡vel com wizards interativos
4. AuditÃ¡vel: Logs completos e relatÃ³rios de seguranÃ§a
5. ExtensÃ­vel: Arquitetura modular para novos recursos

ğŸš€ Entrega Esperada

VocÃª deve entregar:

1. âœ… CÃ³digo Python completo da aplicaÃ§Ã£o
2. âœ… CLI funcional com todos os comandos
3. âœ… Testes unitÃ¡rios para funÃ§Ãµes crÃ­ticas
4. âœ… DocumentaÃ§Ã£o completa (README, exemplos)
5. âœ… Setup/InstalaÃ§Ã£o (setup.py, pyproject.toml)
6. âœ… Templates para diferentes tipos de projeto

CritÃ©rios de Qualidade:
- CÃ³digo limpo e bem documentado
- Tratamento robusto de erros
- ValidaÃ§Ã£o de entrada do usuÃ¡rio
- Logs informativos mas seguros
- Compatibilidade Python 3.8+

---
ğŸ¯ Objetivo Final: Criar uma ferramenta que qualquer desenvolvedor Python possa usar para implementar gerenciamento seguro de variÃ¡veis de ambiente em
seus projetos, seguindo as melhores prÃ¡ticas de seguranÃ§a da soluÃ§Ã£o original do PoisSim.
